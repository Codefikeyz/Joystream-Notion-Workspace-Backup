# NFT bugfix testing

Ticket [#767](https://github.com/Joystream/community-repo/issues/767)

**Network**: wss://44.199.232.212.nip.io/ws-rpc 

**Query Node**: https://44.199.232.212.nip.io/query-node/server/graphql 

**Config**: https://44.199.232.212.nip.io/network/config.json

## Time spent

[NFT bugfix hours](NFT%20bugfix%20testing/NFT%20bugfix%20hours%201f5717a2757d4c3489303862add027e2.csv)

Total time spent: **28h**

## Testing setup

[NFT bugfix setup](NFT%20bugfix%20testing/NFT%20bugfix%20setup%207bcbbb0820ca437ca109ce4def9883db.csv)

## Important blockheights

[NFT bugfix block-heights](NFT%20bugfix%20testing/NFT%20bugfix%20block-heights%20da226614243a4a61b9c1119838a85c45.csv)

## English Auction (created pre-upgrade)

[NFT bugfix auctions](NFT%20bugfix%20testing/NFT%20bugfix%20auctions%20ed89c38bf47e4a4d822aa6bcb58e55ac.csv)

### Observations

At block [165,481](https://polkadot.js.org/apps/?rpc=wss://44.199.232.212.nip.io/ws-rpc#/explorer/query/165481) when the first `bidder1` made their bid, several things happened 1. New account was created 5EYCAe5i6QresjyUG22eKpsy1R5dyFHok4B3jXP712J4NKDu, endowed 1M tJOY 2. A 1M tJOY transfer from bidder account to this newly created account took place.

I guess this is how the internal logic of placing the bid works. However, Pioneer showed that `bidder1` wallet balance is still `10M`, not `9M`. Possible QN bug??

When second `bidder2` [made their bid](https://polkadot.js.org/apps/?rpc=wss://44.199.232.212.nip.io/ws-rpc#/explorer/query/0xd73a31d9bce17bd48c14283669b3587945e5a6e535f2114bbf9db37c82d01752), the sequence of events was remarkably different.

1. Account created as a result of the first bid 5EYCAe5i6QresjyUG22eKpsy1R5dyFHok4B3jXP712J4NKDu was killed (`acountKilled`)
2. A 1M tJOY transfer from killed account to `bidder1` account took place.
3. Account with the same address was created 5EYCAe5i6QresjyUG22eKpsy1R5dyFHok4B3jXP712J4NKDu, endowed 1.25M tJOY
4. A 1.25M tJOY transfer from `bidder2` account to this newly created account took place.

For me the above behavior makes sense, except the wrong balance after the first bid.

[Untitled](NFT%20bugfix%20testing/Untitled%20712f91b361d24b969ef29fadf3b80994.csv)

Similar sequence of events happened: outbid `bidder2` got their bid returned, `bidder1` balance reduced by 1.5M tJOY. Pioneer displayed the balances correctly!

### Outcome

ðŸ›‘ Seller account isnâ€™t credited. 

ðŸ›‘ Buyer account looks incorrect (should have spent `10M  - (1.5M + 190K + 150K) = 8.16M`), Pioneer shows `8.3101 MJOY` 

ðŸ›‘ Burned 12.5K tJOY

# Open Auction (created pre-upgrade)

[Untitled](NFT%20bugfix%20testing/Untitled%20b56a214d085647eab23cd1986a95d4a4.csv)

Outbid `bidder1` doesnâ€™t seem to get their bid back. Their balance is `8.4M = 10M - 1.5M -100K` . Maybe this is how open auctons work ðŸ¤¨

[Untitled](NFT%20bugfix%20testing/Untitled%206db28f3e6e1644bcbb75c0caf9a1b5b4.csv)

Interestingly, as a result of this, only a difference was debited from `bidder1` account: `90K = 190K - 100K`, which seems logical, as the original bid was increased by `90K`.

[Untitled](NFT%20bugfix%20testing/Untitled%2069b71326e9264142a58642740701d1ff.csv)

### Outcome

âœ… Seller wallet was credited `188K tJOY` 

âœ… Buyer wallet balance seems correct 

ðŸ›‘ 190K tJOY was burned (see decrease in total issuance)

# Fixed Price Listing (created pre-upgrade)

[Untitled](NFT%20bugfix%20testing/Untitled%2027e2983631be452785c00aefc73ee74a.csv)

### Outcome

âœ… Seller wallet was credited `150K tJOY` 

ðŸ›‘ Buyer wallet balance didnâ€™t change!! 

ðŸ›‘ 150K tJOY was burned (see decrease in total issuance)

# Post-upgrade English Auction

Created at block `# 167,357`

[Untitled](NFT%20bugfix%20testing/Untitled%20edbaee54f0594c88a9cdb1d0932d57db.csv)

### Observations

1. Unlike pre-upgrade English auction, this time I saw that balances of all bidders updated accordingly in Pioneer.
2. No `acountKilled` event observed

### Outcome

âœ… Seller wallet was credited `1237500 tJOY` 

âœ… Buyer wallet balance seems correct `6.75M tJOY` 

âœ… 12.5 tJOY was burned (1% of winning bid)

# Post-upgrade Open Auction

Created at block `# 167,339`

[Untitled](NFT%20bugfix%20testing/Untitled%20d5453d16aba04a1aae360c5cb7499320.csv)

### Outcome

âœ… Seller wallet was credited `1.980K tJOY` 

âœ… Buyer wallet balance seems correct `6.75M tJOY` 

âœ… 20K tJOY was burned (1% of winning bid)

# Post-upgrade Fixed Price Listing

Created at block `# 167,179` (Buy-Now price **5M**)

[Untitled](NFT%20bugfix%20testing/Untitled%20352f2e11517144b083db60a93b0e2d80.csv)

### Outcome

âœ… Seller wallet was credited `4.95M tJOY` 

âœ… Buyer wallet balance seems correct `4M tJOY` 

âœ… 50K tJOY was burned (1% of winning bid)